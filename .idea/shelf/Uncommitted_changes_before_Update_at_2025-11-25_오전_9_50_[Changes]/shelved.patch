Index: app/src/main/java/com/example/travelapp/ui/viewModel/LoginViewModel.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.travelapp.ui.viewModel\r\n\r\nimport android.content.Context\r\nimport android.util.Log\r\nimport androidx.lifecycle.ViewModel\r\nimport androidx.lifecycle.viewModelScope\r\nimport com.example.travelapp.BuildConfig\r\nimport com.example.travelapp.data.model.SocialLoginRequest\r\nimport com.example.travelapp.data.model.User\r\nimport com.example.travelapp.data.repository.AuthRepository\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInAccount\r\nimport com.google.android.gms.common.api.ApiException\r\nimport com.google.android.gms.tasks.Task\r\nimport dagger.hilt.android.lifecycle.HiltViewModel\r\nimport com.kakao.sdk.common.model.ClientError\r\nimport com.kakao.sdk.common.model.ClientErrorCause\r\nimport com.kakao.sdk.user.UserApiClient\r\nimport com.navercorp.nid.NaverIdLoginSDK\r\nimport com.navercorp.nid.oauth.OAuthLoginCallback\r\nimport kotlinx.coroutines.flow.MutableSharedFlow\r\nimport kotlinx.coroutines.flow.MutableStateFlow\r\nimport kotlinx.coroutines.flow.asSharedFlow\r\nimport kotlinx.coroutines.flow.asStateFlow\r\nimport kotlinx.coroutines.launch\r\nimport javax.inject.Inject\r\n\r\ndata class LoginUiState(\r\n    val isLoading: Boolean = false,\r\n    val loginSuccessUser: User? = null,\r\n    val error: String? = null\r\n)\r\n\r\n@HiltViewModel\r\nclass LoginViewModel @Inject constructor(\r\n    private val authRepository: AuthRepository\r\n) : ViewModel() {\r\n\r\n    private val _loginEvent = MutableSharedFlow<LoginEvent>()\r\n    val loginEvent = _loginEvent.asSharedFlow()\r\n\r\n    private val _loginUiState = MutableStateFlow(LoginUiState())\r\n    val loginUiState = _loginUiState.asStateFlow()\r\n\r\n    private val appName = \"MoyeoLog\"\r\n    private val TAG = \"LoginViewModel\"\r\n\r\n\r\n    fun loginWithNaver(context: Context) {\r\n        viewModelScope.launch {\r\n            try {\r\n                NaverIdLoginSDK.initialize(\r\n                    context,\r\n                    BuildConfig.NAVER_CLIENT_ID,\r\n                    BuildConfig.NAVER_CLIENT_SECRET,\r\n                    appName\r\n                )\r\n                NaverIdLoginSDK.authenticate(context, object : OAuthLoginCallback {\r\n                    override fun onSuccess() {\r\n                        viewModelScope.launch {\r\n                            Log.i(TAG, \"네이버 로그인 성공, 토큰 : ${NaverIdLoginSDK.getAccessToken()}\")\r\n                            _loginEvent.emit(LoginEvent.LoginSuccess)\r\n                        }\r\n                    }\r\n\r\n                    override fun onFailure(httpStatus: Int, message: String) {\r\n                        viewModelScope.launch {\r\n                            val errorCode = NaverIdLoginSDK.getLastErrorCode().code\r\n                            val errorDescription = NaverIdLoginSDK.getLastErrorDescription()\r\n                            Log.e(TAG, \"네이버 로그인 실패 - 코드: $errorCode, 설명: $errorDescription\")\r\n                            _loginEvent.emit(LoginEvent.LoginFailed(\"네이버 로그인에 실패했습니다.\"))\r\n                        }\r\n                    }\r\n\r\n                    override fun onError(errorCode: Int, message: String) {\r\n                        onFailure(errorCode, message)\r\n                    }\r\n                })\r\n            } catch (e: Exception) {\r\n                Log.e(TAG, \"네이버 로그인 SDK 초기화 또는 인증 요청 실패\", e)\r\n                emitLoginFailed(\"네이버 로그인 중 오류가 발생했습니다.\")\r\n            }\r\n        }\r\n    }\r\n\r\n    fun handleGoogleSignInResult(task: Task<GoogleSignInAccount>) {\r\n        try {\r\n            val account: GoogleSignInAccount? = task.getResult(ApiException::class.java)\r\n            if (account != null) {\r\n                Log.i(TAG, \"구글 로그인 성공. 서버에 로그인 요청 시작.\")\r\n\r\n                // [수정] email과 id가 null이 아닌지 안전하게 확인하고 서버에 요청합니다.\r\n                val userEmail = account.email\r\n                val userId = account.id\r\n\r\n                if (userEmail != null && userId != null) {\r\n                    requestSocialLogin(\r\n                        email = userEmail,\r\n                        nickname = account.displayName,\r\n                        profileImage = account.photoUrl?.toString(),\r\n                        provider = \"google\",\r\n                        socialId = userId\r\n                    )\r\n                } else {\r\n                    Log.e(TAG, \"Google 로그인 실패: email 또는 id가 null입니다.\")\r\n                    emitLoginFailed(\"구글 계정 정보를 가져오는데 실패했습니다.\")\r\n                }\r\n            } else {\r\n                Log.e(TAG, \"구글 로그인 실패: account is null\")\r\n                emitLoginFailed(\"구글 로그인 정보를 가져오는데 실패했습니다.\")\r\n            }\r\n        } catch (e: ApiException) {\r\n            val errorMessage = when (e.statusCode) {\r\n                10 -> \"개발자 콘솔에 등록된 앱과 서명(SHA-1)이 일치하지 않습니다.\"\r\n                12500 -> \"Google Play 서비스 업데이트가 필요하거나, 로그인 설정에 문제가 있습니다.\"\r\n                12501 -> \"사용자가 로그인을 취소했습니다.\"\r\n                else -> \"구글 로그인 실패: ${e.statusCode}\"\r\n            }\r\n            Log.e(TAG, \"Google Sign-In failed with ApiException: ${e.statusCode}\", e)\r\n            emitLoginFailed(errorMessage)\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"An unexpected error occurred during Google Sign-In\", e)\r\n            emitLoginFailed(\"예상치 못한 오류가 발생했습니다.\")\r\n        }\r\n    }\r\n\r\n    private fun requestSocialLogin(email: String, nickname: String?, profileImage: String?, provider: String, socialId: String) {\r\n        viewModelScope.launch {\r\n            _loginUiState.value = LoginUiState(isLoading = true)\r\n            try {\r\n                val request = SocialLoginRequest(email, nickname, profileImage, provider, socialId)\r\n                val response = authRepository.socialLogin(request)\r\n\r\n                if (response.isSuccessful && response.body() != null) {\r\n                    val loginData = response.body()!!\r\n                    // TODO: 토큰 저장 로직 (다음 단계)\r\n                    _loginUiState.value = LoginUiState(loginSuccessUser = loginData.user)\r\n                    _loginEvent.emit(LoginEvent.LoginSuccess)\r\n                } else {\r\n                    _loginUiState.value = LoginUiState(error = \"서버 로그인 실패: ${response.code()}\")\r\n                    emitLoginFailed(\"서버 로그인에 실패했습니다.\")\r\n                }\r\n            } catch (e: Exception) {\r\n                _loginUiState.value = LoginUiState(error = \"서버 통신 오류: ${e.message}\")\r\n                emitLoginFailed(\"로그인 중 오류가 발생했습니다.\")\r\n            }\r\n        }\r\n    }\r\n\r\n    fun emitLoginFailed(message: String) {\r\n        viewModelScope.launch {\r\n            _loginEvent.emit(LoginEvent.LoginFailed(message))\r\n        }\r\n    }\r\n\r\n    fun loginWithKakaoTalk(context: Context) {\r\n        if (UserApiClient.instance.isKakaoTalkLoginAvailable(context)) {\r\n            UserApiClient.instance.loginWithKakaoTalk(context) { token, error ->\r\n                if (error != null) {\r\n                    if (error is ClientError && error.reason == ClientErrorCause.Cancelled) {\r\n                        emitLoginFailed(\"카카오톡 로그인이 취소되었습니다.\")\r\n                        return@loginWithKakaoTalk\r\n                    }\r\n                    loginWithKakaoAccount(context)\r\n                } else if (token != null) {\r\n                    handleKakaoLoginSuccess(token.accessToken)\r\n                }\r\n            }\r\n        } else {\r\n            loginWithKakaoAccount(context)\r\n        }\r\n    }\r\n\r\n    private fun loginWithKakaoAccount(context: Context) {\r\n        UserApiClient.instance.loginWithKakaoAccount(context) { token, error ->\r\n            if (error != null) {\r\n                emitLoginFailed(\"카카오계정 로그인 실패: ${error.message}\")\r\n            } else if (token != null) {\r\n                handleKakaoLoginSuccess(token.accessToken)\r\n            }\r\n        }\r\n    }\r\n\r\n    private fun handleKakaoLoginSuccess(accessToken: String) {\r\n        UserApiClient.instance.me { user, error ->\r\n            if (error != null) {\r\n                Log.e(TAG, \"카카오 사용자 정보 요청 실패\", error)\r\n                emitLoginFailed(\"카카오 사용자 정보를 가져오는데 실패했습니다.\")\r\n            } else if (user != null) {\r\n                Log.i(TAG, \"카카오 사용자 정보 요청 성공. 서버에 로그인 요청 시작.\")\r\n\r\n                // [수정] 카카오 로그인도 email과 id가 null이 아닌지 안전하게 확인합니다.\r\n                val userEmail = user.kakaoAccount?.email\r\n                val userId = user.id\r\n\r\n                if (userEmail != null && userId != null) {\r\n                    requestSocialLogin(\r\n                        email = userEmail,\r\n                        nickname = user.kakaoAccount?.profile?.nickname,\r\n                        profileImage = user.kakaoAccount?.profile?.thumbnailImageUrl,\r\n                        provider = \"kakao\",\r\n                        socialId = userId.toString()\r\n                    )\r\n                } else {\r\n                    Log.e(TAG, \"Kakao 로그인 실패: email 또는 id가 null입니다.\")\r\n                    emitLoginFailed(\"카카오 계정 정보를 가져오는데 실패했습니다.\")\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nsealed class LoginEvent {\r\n    object LoginSuccess : LoginEvent()\r\n    data class LoginFailed(val message: String) : LoginEvent()\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/travelapp/ui/viewModel/LoginViewModel.kt b/app/src/main/java/com/example/travelapp/ui/viewModel/LoginViewModel.kt
--- a/app/src/main/java/com/example/travelapp/ui/viewModel/LoginViewModel.kt	(revision b82f2abad7d737c97493be109ffa37b9ee6627de)
+++ b/app/src/main/java/com/example/travelapp/ui/viewModel/LoginViewModel.kt	(date 1764031801922)
@@ -154,7 +154,8 @@
 
     fun loginWithKakaoTalk(context: Context) {
         if (UserApiClient.instance.isKakaoTalkLoginAvailable(context)) {
-            UserApiClient.instance.loginWithKakaoTalk(context) { token, error ->
+            val scopes = listOf("account_email")
+            UserApiClient.instance.loginWithKakaoTalk(context, scopes = scopes) { token, error ->
                 if (error != null) {
                     if (error is ClientError && error.reason == ClientErrorCause.Cancelled) {
                         emitLoginFailed("카카오톡 로그인이 취소되었습니다.")
@@ -171,7 +172,8 @@
     }
 
     private fun loginWithKakaoAccount(context: Context) {
-        UserApiClient.instance.loginWithKakaoAccount(context) { token, error ->
+        val scopes = listOf("account_email")
+        UserApiClient.instance.loginWithKakaoAccount(context, scopes = scopes) { token, error ->
             if (error != null) {
                 emitLoginFailed("카카오계정 로그인 실패: ${error.message}")
             } else if (token != null) {
Index: .idea/deploymentTargetSelector.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"deploymentTargetSelector\">\r\n    <selectionStates>\r\n      <SelectionState runConfigName=\"app\">\r\n        <option name=\"selectionMode\" value=\"DROPDOWN\" />\r\n      </SelectionState>\r\n      <SelectionState runConfigName=\"MainActivity\">\r\n        <option name=\"selectionMode\" value=\"DROPDOWN\" />\r\n        <DropdownSelection timestamp=\"2025-11-22T06:06:00.980211100Z\">\r\n          <Target type=\"DEFAULT_BOOT\">\r\n            <handle>\r\n              <DeviceId pluginId=\"LocalEmulator\" identifier=\"path=C:\\Users\\PC\\.android\\avd\\Medium_Phone.avd\" />\r\n            </handle>\r\n          </Target>\r\n        </DropdownSelection>\r\n        <DialogSelection />\r\n      </SelectionState>\r\n    </selectionStates>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/deploymentTargetSelector.xml b/.idea/deploymentTargetSelector.xml
--- a/.idea/deploymentTargetSelector.xml	(revision b82f2abad7d737c97493be109ffa37b9ee6627de)
+++ b/.idea/deploymentTargetSelector.xml	(date 1763958566903)
@@ -4,13 +4,10 @@
     <selectionStates>
       <SelectionState runConfigName="app">
         <option name="selectionMode" value="DROPDOWN" />
-      </SelectionState>
-      <SelectionState runConfigName="MainActivity">
-        <option name="selectionMode" value="DROPDOWN" />
-        <DropdownSelection timestamp="2025-11-22T06:06:00.980211100Z">
+        <DropdownSelection timestamp="2025-11-24T04:24:03.521087900Z">
           <Target type="DEFAULT_BOOT">
             <handle>
-              <DeviceId pluginId="LocalEmulator" identifier="path=C:\Users\PC\.android\avd\Medium_Phone.avd" />
+              <DeviceId pluginId="LocalEmulator" identifier="path=C:\Users\dlack\.android\avd\Medium_Phone.avd" />
             </handle>
           </Target>
         </DropdownSelection>
